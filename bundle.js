!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return i(n?n:e)},h,h.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e){var t,n,r,i,o,s=e("peer-file/send"),a=e("peer-file/receive"),c=e("history-state")({hash:!0}),u=e("peerjs")(null,{key:"5eqjv36bbwamunmi"});u.on("open",function(e){if(o=e,i=document.createElement("p"),t=document.createElement("form"),n=document.createElement("label"),r=document.createElement("input"),r.type="file",r.id="id-"+o,r.style.display="none",n.setAttribute("for",r.id),!location.hash){var s=location.href.replace(/^([^#]+).*$/,function(e,t){return t+"#"+o});i.innerHTML="Give this URL to someone: "+s.link(s)}t.appendChild(n),t.appendChild(r),document.body.appendChild(i),document.body.appendChild(t)});var h=function(e){e.on("open",function(){n.textContent="Send a file to "+e.peer,i.innerHTML="",r.style.display="block",a(e).on("incoming",function(e){confirm("About to download “"+e.name+"”")?this.accept(e):this.reject(e)}).on("progress",function(e,t){var n=Math.ceil(t/e.size*100);i.textContent="Downloaded "+n+"% of “"+e.name+"”"}).on("complete",function(e){var t=new Blob(e.data,{type:e.type}),n=(URL||webkitURL).createObjectURL(t),r=document.createElement("a");setTimeout(function(){i.innerHTML="Download ",r.href=n,r.target="_blank",r.textContent=e.name,i.appendChild(r)})}),r.onchange=function(){var n=r.files[0];s(e,n).on("progress",function(e){var t=Math.ceil(e/n.size*100);i.textContent="Sent "+t+"% of “"+n.name+"”"}),t.reset()}})};u.on("connection",h),c.on("change",function(){var e=location.hash.replace(/^#/,"");e&&e!==o&&h(u.connect(e))})},{"history-state":2,"peer-file/receive":12,"peer-file/send":13,peerjs:18}],2:[function(e,t){var n=e("raf-component"),r=e("emitter-component"),i=e("eventlistener"),o=window.history,s=window.location,a=o.pushState,c=!!a,u=function(e){if(!(this instanceof u))return new u(e);var t=e&&e.pushState,n=e&&e.hash;if(this.usePushState=t||c&&!n,this.usePushState&&!c&&!n)throw new Error("This browser does not support history.pushState.");this.started=!1,this.start=this.start.bind(this),this.announce=this.emit.bind(this,"change"),this.start()};r(u.prototype),u.prototype.start=function(){n(function(){this.started||(this.started=!0,this.announce(),this.usePushState?i.add(window,"popstate",this.announce):i.add(window,"hashchange",this.announce))}.bind(this))},u.prototype.stop=function(){this.usePushState?i.remove(window,"popstate",this.announce):i.remove(window,"hashchange",this.announce)},u.prototype.change=function(e){var t=s.pathname,n=s.hash,r=/^#/.test(e),i=r?e===n:this.usePushState?e===t+n:e===n.substr(1);return i?!1:(this.set(e),!0)},u.prototype.set=function(e){return this.usePushState?(o.pushState(null,null,e),this.announce(),!0):(s.hash=e,!0)},t.exports=u},{"emitter-component":3,eventlistener:4,"raf-component":5}],3:[function(e,t){function n(e){return e?r(e):void 0}function r(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){function n(){r.off(e,n),t.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var r=0,i=n.length;i>r;++r)n[r].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],4:[function(e,t,n){!function(e,r){"function"==typeof define&&define.amd?define(r):"object"==typeof n?t.exports=r():e.eventListener=r()}(this,function(){function e(e,t){return function(n,r,i,o){n[e]?n[e](r,i,o):n[t]&&n[t]("on"+r,i)}}return{add:e("addEventListener","attachEvent"),remove:e("removeEventListener","detachEvent")}})},{}],5:[function(e,t,n){function r(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-i)),r=setTimeout(e,n);return i=t,r}n=t.exports=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||r;var i=(new Date).getTime(),o=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout;n.cancel=function(e){o.call(window,e)}},{}],6:[function(e,t){(function(n){function r(e,t){if(!(this instanceof r))return new r(e,t);t=t||{},t.output=t.output||"arraybuffer",this.options=t,this._file=e,this.readable=!0,this.offset=t.offset||0,this.paused=!1,this.chunkSize=this.options.chunkSize||8128;var n=["name","size","type","lastModifiedDate"];n.forEach(function(t){this[t]=e[t]},this)}var i=e("inherits"),o=e("events").EventEmitter;t.exports=r,r.prototype._FileReader=function(){var e=this,t=new FileReader,r=this.options.output;return t.onloadend=function(t){var i=t.target.result;return i instanceof ArrayBuffer&&(i=new n(new Uint8Array(t.target.result))),e.dest.write(i),e.offset<e._file.size?(e.emit("progress",e.offset),!e.paused&&e.readChunk(r),void 0):(e._end(),void 0)},t.onerror=function(t){e.emit("error",t.target.error)},t},r.prototype.readChunk=function(e){var t=this.offset+this.chunkSize,n=this._file.slice(this.offset,t);this.offset=t,"binary"===e?this.reader.readAsBinaryString(n):"dataurl"===e?this.reader.readAsDataURL(n):"arraybuffer"===e?this.reader.readAsArrayBuffer(n):"text"===e&&this.reader.readAsText(n)},r.prototype._end=function(){this.dest===console||this.options&&this.options.end===!1||(this.dest.end&&this.dest.end(),this.dest.close&&this.dest.close(),this.emit("end",this._file.size))},r.prototype.pipe=function(e){return this.reader=this._FileReader(),this.readChunk(this.options.output),this.dest=e,e},r.prototype.pause=function(){return this.paused=!0,this.offset},r.prototype.resume=function(){this.paused=!1,this.readChunk(this.options.output)},r.prototype.abort=function(){return this.paused=!0,this.reader.abort(),this._end(),this.offset},i(r,o)}).call(this,e("buffer").Buffer)},{buffer:26,events:30,inherits:7}],7:[function(e,t){function n(e,t,n){n=n||{};var r={};[e.prototype,n].forEach(function(e){Object.getOwnPropertyNames(e).forEach(function(t){r[t]=Object.getOwnPropertyDescriptor(e,t)})}),e.prototype=Object.create(t.prototype,r),e.super=t}t.exports=n},{}],8:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],9:[function(e,t){t.exports=Array},{}],10:[function(e,t){(function(e){var n;if(e.crypto&&crypto.getRandomValues){var r=new Uint8Array(16);n=function(){return crypto.getRandomValues(r),r}}if(!n){var i=new Array(16);n=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(e,t){function n(e,t,n){var r=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>i&&(t[r+i++]=u[e])});16>i;)t[r+i++]=0;return t}function r(e,t){var n=t||0,r=c;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function i(e,t,n){var i=t&&n||0,o=t||[];e=e||{};var s=void 0!==e.clockseq?e.clockseq:l,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:v+1,u=a-d+(c-v)/1e4;if(0>u&&void 0===e.clockseq&&(s=s+1&16383),(0>u||a>d)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=a,v=c,l=s,a+=122192928e5;var h=(1e4*(268435455&a)+c)%4294967296;o[i++]=h>>>24&255,o[i++]=h>>>16&255,o[i++]=h>>>8&255,o[i++]=255&h;var p=a/4294967296*1e4&268435455;o[i++]=p>>>8&255,o[i++]=255&p,o[i++]=p>>>24&15|16,o[i++]=p>>>16&255,o[i++]=s>>>8|128,o[i++]=255&s;for(var y=e.node||f,g=0;6>g;g++)o[i+g]=y[g];return t?t:r(o)}function o(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"==e?new a(16):null,e=null),e=e||{};var o=e.random||(e.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var c=0;16>c;c++)t[i+c]=o[c];return t||r(o)}for(var s=e("./rng"),a=e("./buffer"),c=[],u={},h=0;256>h;h++)c[h]=(h+256).toString(16).substr(1),u[c[h]]=h;var p=s(),f=[1|p[0],p[1],p[2],p[3],p[4],p[5]],l=16383&(p[6]<<8|p[7]),d=0,v=0,y=o;y.v1=i,y.v4=o,y.parse=n,y.unparse=r,y.BufferClass=a,t.exports=y},{"./buffer":9,"./rng":10}],12:[function(e,t){var n=e("inherits"),r=e("events").EventEmitter,i=function(e){return this instanceof i?(this.received={},this.connection=e,this.handle=this.handle.bind(this),this.connection.on("data",this.handle),void 0):new i(e)};n(i,r),i.prototype.handle=function(e){var t=/^file:(start|chunk|end|cancel)$/;if(e.type&&!t.test(e.type))return!1;var n=this.received[e.id]||{};if("file:start"===e.type)n=e.meta,n.id=e.id,n.accepted=!1,n.cancelled=!1,n.data=[],this.received[e.id]=n,this.emit("incoming",n);else if("file:chunk"===e.type&&n.accepted&&!n.cancelled){n.data.push(e.chunk);var r=n.data.length*n.chunkSize;r>n.size&&(r=n.size),this.received[e.id]=n,this.emit("progress",n,r)}else"file:end"===e.type&&n.accepted?(this.emit("progress",n,n.size),this.emit("complete",n)):"file:cancel"===e.type&&(n.cancelled=!0,this.received[e.id]=n,this.emit("cancel",n))},i.prototype.accept=function(e){return this.received[e.id].accepted=!0,setTimeout(function(){this.connection.send({type:"file:accept"})}.bind(this)),this},i.prototype.reject=function(e){return this.received[e.id].accepted=!1,setTimeout(function(){this.connection.send({type:"file:reject"})}.bind(this)),this},i.prototype.pause=function(){return this.connection.send({type:"file:pause"}),this},i.prototype.resume=function(){return this.connection.send({type:"file:resume"}),this},i.prototype.cancel=function(e){return e.cancelled=!0,this.received[e.id]=e,this.connection.send({type:"file:cancel"}),this},t.exports=i},{events:30,inherits:8}],13:[function(e,t){var n=e("uuid"),r=e("filereader-stream"),i=e("inherits"),o=e("events").EventEmitter,s=function(e,t){return this instanceof s?(this.id=n.v4(),this.connection=e,this.file=t,this.chunkSize=Math.pow(2,13),this.totalChunks=Math.ceil(this.file.size/this.chunkSize),this.stream=null,this.handle=this.handle.bind(this),this.connection.on("data",this.handle),this.connection.send({type:"file:start",id:this.id,meta:{name:this.file.name,type:this.file.type,size:this.file.size,chunkSize:this.chunkSize,totalChunks:this.totalChunks}}),void 0):new s(e,t)};i(s,o),s.prototype.handle=function(e){var t=/^file:(accept|reject|pause|resume|cancel)$/,n=e.type||"",r=(n.match(t)||[])[1];r&&this[r]()},s.prototype.pause=function(){return this.stream&&!this.stream.paused&&(this.stream.pause(),this.emit("pause")),this},s.prototype.resume=function(){return this.stream&&this.stream.paused&&(this.stream.resume(),this.emit("resume")),this},s.prototype.accept=function(){return this.emit("accept"),this.stream=r(this.file,{chunkSize:this.chunkSize}),this.stream.pipe({write:function(e){this.connection.send({type:"file:chunk",id:this.id,chunk:e})}.bind(this),end:function(){this.connection.removeListener("data",this.handle),this.cancelled||(this.connection.send({type:"file:end",id:this.id}),this.emit("progress",this.file.size),this.emit("complete"))}.bind(this)}),this.stream.on("error",function(){}),this.stream.on("progress",function(e){this.emit("progress",e)}.bind(this)),this},s.prototype.reject=function(){return this.stream?this.cancel():this.emit("reject"),this},s.prototype.cancel=function(){return this.cancelled=!0,setTimeout(function(){this.stream&&(this.stream.abort(),this.stream=null),this.connection.send({type:"file:cancel",id:this.id}),this.emit("cancel")}.bind(this)),this},t.exports=s},{events:30,"filereader-stream":6,inherits:8,uuid:11}],14:[function(e,t){t.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,t.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,t.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],15:[function(e,t){function n(e,t,s){return this instanceof n?(i.call(this),this.options=r.extend({serialization:"binary",reliable:!1},s),this.open=!1,this.type="data",this.peer=e,this.provider=t,this.id=this.options.connectionId||n._idPrefix+r.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),o.startConnection(this,this.options._payload||{originator:!0}),void 0):new n(e,t,s)}var r=e("./util"),i=e("eventemitter3"),o=e("./negotiator"),s=e("reliable");r.inherits(n,i),n._idPrefix="dc_",n.prototype.initialize=function(e){this._dc=this.dataChannel=e,this._configureDataChannel()},n.prototype._configureDataChannel=function(){var e=this;r.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){r.log("Data channel connection success"),e.open=!0,e.emit("open")},!r.supports.sctp&&this.reliable&&(this._reliable=new s(this._dc,r.debug)),this._reliable?this._reliable.onmessage=function(t){e.emit("data",t)}:this._dc.onmessage=function(t){e._handleDataMessage(t)},this._dc.onclose=function(){r.log("DataChannel closed for:",e.peer),e.close()}},n.prototype._handleDataMessage=function(e){var t=this,n=e.data,i=n.constructor;if("binary"===this.serialization||"binary-utf8"===this.serialization){if(i===Blob)return r.blobToArrayBuffer(n,function(e){n=r.unpack(e),t.emit("data",n)}),void 0;if(i===ArrayBuffer)n=r.unpack(n);else if(i===String){var o=r.binaryStringToArrayBuffer(n);n=r.unpack(o)}}else"json"===this.serialization&&(n=JSON.parse(n));if(n.__peerData){var s=n.__peerData,a=this._chunkedData[s]||{data:[],count:0,total:n.total};return a.data[n.n]=n.data,a.count+=1,a.total===a.count&&(delete this._chunkedData[s],n=new Blob(a.data),this._handleDataMessage({data:n})),this._chunkedData[s]=a,void 0}this.emit("data",n)},n.prototype.close=function(){this.open&&(this.open=!1,o.cleanup(this),this.emit("close"))},n.prototype.send=function(e,t){if(!this.open)return this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages.")),void 0;if(this._reliable)return this._reliable.send(e),void 0;var n=this;if("json"===this.serialization)this._bufferedSend(JSON.stringify(e));else if("binary"===this.serialization||"binary-utf8"===this.serialization){var i=r.pack(e),o=r.chunkedBrowsers[this._peerBrowser]||r.chunkedBrowsers[r.browser];if(o&&!t&&i.size>r.chunkedMTU)return this._sendChunks(i),void 0;r.supports.sctp?r.supports.binaryBlob?this._bufferedSend(i):r.blobToArrayBuffer(i,function(e){n._bufferedSend(e)}):r.blobToBinaryString(i,function(e){n._bufferedSend(e)})}else this._bufferedSend(e)},n.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this.bufferSize=this._buffer.length)},n.prototype._trySend=function(e){try{this._dc.send(e)}catch(t){this._buffering=!0;var n=this;return setTimeout(function(){n._buffering=!1,n._tryBuffer()},100),!1}return!0},n.prototype._tryBuffer=function(){if(0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())}},n.prototype._sendChunks=function(e){for(var t=r.chunk(e),n=0,i=t.length;i>n;n+=1){var e=t[n];this.send(e,!0)}},n.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":this._peerBrowser=t.browser,o.handleSDP(e.type,this,t.sdp);break;case"CANDIDATE":o.handleCandidate(this,t.candidate);break;default:r.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},t.exports=n},{"./negotiator":17,"./util":20,eventemitter3:21,reliable:24}],16:[function(e,t){function n(e,t,s){return this instanceof n?(i.call(this),this.options=r.extend({},s),this.open=!1,this.type="media",this.peer=e,this.provider=t,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||n._idPrefix+r.randomToken(),this.localStream&&o.startConnection(this,{_stream:this.localStream,originator:!0}),void 0):new n(e,t,s)}var r=e("./util"),i=e("eventemitter3"),o=e("./negotiator");r.inherits(n,i),n._idPrefix="mc_",n.prototype.addStream=function(e){r.log("Receiving stream",e),this.remoteStream=e,this.emit("stream",e)},n.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":o.handleSDP(e.type,this,t.sdp),this.open=!0;break;case"CANDIDATE":o.handleCandidate(this,t.candidate);break;default:r.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},n.prototype.answer=function(e){if(this.localStream)return r.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?"),void 0;this.options._payload._stream=e,this.localStream=e,o.startConnection(this,this.options._payload);for(var t=this.provider._getMessages(this.id),n=0,i=t.length;i>n;n+=1)this.handleMessage(t[n]);this.open=!0},n.prototype.close=function(){this.open&&(this.open=!1,o.cleanup(this),this.emit("close"))},t.exports=n},{"./negotiator":17,"./util":20,eventemitter3:21}],17:[function(e,t){var n=e("./util"),r=e("./adapter").RTCPeerConnection,i=e("./adapter").RTCSessionDescription,o=e("./adapter").RTCIceCandidate,s={pcs:{data:{},media:{}},queue:[]};s._idPrefix="pc_",s.startConnection=function(e,t){var r=s._getPeerConnection(e,t);if("media"===e.type&&t._stream&&r.addStream(t._stream),e.pc=e.peerConnection=r,t.originator){if("data"===e.type){var i={};n.supports.sctp||(i={reliable:t.reliable});var o=r.createDataChannel(e.label,i);e.initialize(o)}n.supports.onnegotiationneeded||s._makeOffer(e)}else s.handleSDP("OFFER",e,t.sdp)},s._getPeerConnection=function(e,t){s.pcs[e.type]||n.error(e.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),s.pcs[e.type][e.peer]||(s.pcs[e.type][e.peer]={});{var r;s.pcs[e.type][e.peer]}return t.pc&&(r=s.pcs[e.type][e.peer][t.pc]),r&&"stable"===r.signalingState||(r=s._startPeerConnection(e)),r},s._startPeerConnection=function(e){n.log("Creating RTCPeerConnection.");var t=s._idPrefix+n.randomToken(),i={};"data"!==e.type||n.supports.sctp?"media"===e.type&&(i={optional:[{DtlsSrtpKeyAgreement:!0}]}):i={optional:[{RtpDataChannels:!0}]};var o=new r(e.provider.options.config,i);return s.pcs[e.type][e.peer][t]=o,s._setupListeners(e,o,t),o},s._setupListeners=function(e,t){var r=e.peer,i=e.id,o=e.provider;n.log("Listening for ICE candidates."),t.onicecandidate=function(t){t.candidate&&(n.log("Received ICE candidates for:",e.peer),o.socket.send({type:"CANDIDATE",payload:{candidate:t.candidate,type:e.type,connectionId:e.id},dst:r}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"disconnected":case"failed":n.log("iceConnectionState is disconnected, closing connections to "+r),e.close();break;case"completed":t.onicecandidate=n.noop}},t.onicechange=t.oniceconnectionstatechange,n.log("Listening for `negotiationneeded`"),t.onnegotiationneeded=function(){n.log("`negotiationneeded` triggered"),"stable"==t.signalingState?s._makeOffer(e):n.log("onnegotiationneeded triggered when not stable. Is another connection being established?")},n.log("Listening for data channel"),t.ondatachannel=function(e){n.log("Received data channel");var t=e.channel,s=o.getConnection(r,i);s.initialize(t)},n.log("Listening for remote stream"),t.onaddstream=function(e){n.log("Received remote stream");var t=e.stream,s=o.getConnection(r,i);"media"===s.type&&s.addStream(t)}},s.cleanup=function(e){n.log("Cleaning up PeerConnection to "+e.peer);var t=e.pc;!t||"closed"===t.readyState&&"closed"===t.signalingState||(t.close(),e.pc=null)},s._makeOffer=function(e){var t=e.pc;t.createOffer(function(r){n.log("Created offer."),!n.supports.sctp&&"data"===e.type&&e.reliable&&(r.sdp=Reliable.higherBandwidthSDP(r.sdp)),t.setLocalDescription(r,function(){n.log("Set localDescription: offer","for:",e.peer),e.provider.socket.send({type:"OFFER",payload:{sdp:r,type:e.type,label:e.label,connectionId:e.id,reliable:e.reliable,serialization:e.serialization,metadata:e.metadata,browser:n.browser},dst:e.peer})},function(t){e.provider.emitError("webrtc",t),n.log("Failed to setLocalDescription, ",t)})},function(t){e.provider.emitError("webrtc",t),n.log("Failed to createOffer, ",t)},e.options.constraints)},s._makeAnswer=function(e){var t=e.pc;t.createAnswer(function(r){n.log("Created answer."),!n.supports.sctp&&"data"===e.type&&e.reliable&&(r.sdp=Reliable.higherBandwidthSDP(r.sdp)),t.setLocalDescription(r,function(){n.log("Set localDescription: answer","for:",e.peer),e.provider.socket.send({type:"ANSWER",payload:{sdp:r,type:e.type,connectionId:e.id,browser:n.browser},dst:e.peer})},function(t){e.provider.emitError("webrtc",t),n.log("Failed to setLocalDescription, ",t)})},function(t){e.provider.emitError("webrtc",t),n.log("Failed to create answer, ",t)})},s.handleSDP=function(e,t,r){r=new i(r);var o=t.pc;n.log("Setting remote description",r),o.setRemoteDescription(r,function(){n.log("Set remoteDescription:",e,"for:",t.peer),"OFFER"===e&&s._makeAnswer(t)},function(e){t.provider.emitError("webrtc",e),n.log("Failed to setRemoteDescription, ",e)})},s.handleCandidate=function(e,t){var r=t.candidate,i=t.sdpMLineIndex;e.pc.addIceCandidate(new o({sdpMLineIndex:i,candidate:r})),n.log("Added ICE candidate for:",e.peer)},t.exports=s},{"./adapter":14,"./util":20}],18:[function(e,t){function n(e,t){return this instanceof n?(i.call(this),e&&e.constructor==Object?(t=e,e=void 0):e&&(e=e.toString()),t=r.extend({debug:0,host:r.CLOUD_HOST,port:r.CLOUD_PORT,key:"peerjs",path:"/",token:r.randomToken(),config:r.defaultConfig},t),this.options=t,"/"===t.host&&(t.host=window.location.hostname),"/"!==t.path[0]&&(t.path="/"+t.path),"/"!==t.path[t.path.length-1]&&(t.path+="/"),void 0===t.secure&&t.host!==r.CLOUD_HOST&&(t.secure=r.isSecure()),t.logFunction&&r.setLogFunction(t.logFunction),r.setLogLevel(t.debug),r.supports.audioVideo||r.supports.data?r.validateId(e)?r.validateKey(t.key)?t.secure&&"0.peerjs.com"===t.host?(this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS."),void 0):(this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),e?this._initialize(e):this._retrieveId(),void 0):(this._delayedAbort("invalid-key",'API KEY "'+t.key+'" is invalid'),void 0):(this._delayedAbort("invalid-id",'ID "'+e+'" is invalid'),void 0):(this._delayedAbort("browser-incompatible","The current browser does not support WebRTC"),void 0)):new n(e,t)}var r=e("./util"),i=e("eventemitter3"),o=e("./socket"),s=e("./mediaconnection"),a=e("./dataconnection");r.inherits(n,i),n.prototype._initializeServerConnection=function(){var e=this;this.socket=new o(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key),this.socket.on("message",function(t){e._handleMessage(t)}),this.socket.on("error",function(t){e._abort("socket-error",t)}),this.socket.on("disconnected",function(){e.disconnected||(e.emitError("network","Lost connection to server."),e.disconnect())}),this.socket.on("close",function(){e.disconnected||e._abort("socket-closed","Underlying socket is already closed.")})},n.prototype._retrieveId=function(){var e=this,t=new XMLHttpRequest,n=this.options.secure?"https://":"http://",i=n+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id",o="?ts="+(new Date).getTime()+Math.random();i+=o,t.open("get",i,!0),t.onerror=function(t){r.error("Error retrieving ID",t);var n="";"/"===e.options.path&&e.options.host!==r.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),e._abort("server-error","Could not get an ID from the server."+n)},t.onreadystatechange=function(){return 4===t.readyState?200!==t.status?(t.onerror(),void 0):(e._initialize(t.responseText),void 0):void 0},t.send(null)},n.prototype._initialize=function(e){this.id=e,this.socket.start(this.id,this.options.token)},n.prototype._handleMessage=function(e){var t,n=e.type,i=e.payload,o=e.src;switch(n){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",i.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":r.log("Received leave message from",o),this._cleanupPeer(o);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+o);break;case"OFFER":var c=i.connectionId;if(t=this.getConnection(o,c))r.warn("Offer received for existing Connection ID:",c);else{if("media"===i.type)t=new s(o,this,{connectionId:c,_payload:i,metadata:i.metadata}),this._addConnection(o,t),this.emit("call",t);else{if("data"!==i.type)return r.warn("Received malformed connection type:",i.type),void 0;t=new a(o,this,{connectionId:c,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable}),this._addConnection(o,t),this.emit("connection",t)}for(var u=this._getMessages(c),h=0,p=u.length;p>h;h+=1)t.handleMessage(u[h])}break;default:if(!i)return r.warn("You received a malformed message from "+o+" of type "+n),void 0;var f=i.connectionId;t=this.getConnection(o,f),t&&t.pc?t.handleMessage(e):f?this._storeMessage(f,e):r.warn("You received an unrecognized message:",e)}},n.prototype._storeMessage=function(e,t){this._lostMessages[e]||(this._lostMessages[e]=[]),this._lostMessages[e].push(t)},n.prototype._getMessages=function(e){var t=this._lostMessages[e];return t?(delete this._lostMessages[e],t):[]},n.prototype.connect=function(e,t){if(this.disconnected)return r.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server."),void 0;var n=new a(e,this,t);return this._addConnection(e,n),n},n.prototype.call=function(e,t,n){if(this.disconnected)return r.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server."),void 0;if(!t)return r.error("To call a peer, you must provide a stream from your browser's `getUserMedia`."),void 0;n=n||{},n._stream=t;var i=new s(e,this,n);return this._addConnection(e,i),i},n.prototype._addConnection=function(e,t){this.connections[e]||(this.connections[e]=[]),this.connections[e].push(t)},n.prototype.getConnection=function(e,t){var n=this.connections[e];if(!n)return null;for(var r=0,i=n.length;i>r;r++)if(n[r].id===t)return n[r];return null},n.prototype._delayedAbort=function(e,t){var n=this;r.setZeroTimeout(function(){n._abort(e,t)})},n.prototype._abort=function(e,t){r.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(e,t)},n.prototype.emitError=function(e,t){r.error("Error:",t),"string"==typeof t&&(t=new Error(t)),t.type=e,this.emit("error",t)},n.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},n.prototype._cleanup=function(){if(this.connections)for(var e=Object.keys(this.connections),t=0,n=e.length;n>t;t++)this._cleanupPeer(e[t]);this.emit("close")},n.prototype._cleanupPeer=function(e){for(var t=this.connections[e],n=0,r=t.length;r>n;n+=1)t[n].close()},n.prototype.disconnect=function(){var e=this;r.setZeroTimeout(function(){e.disconnected||(e.disconnected=!0,e.open=!1,e.socket&&e.socket.close(),e.emit("disconnected",e.id),e._lastServerId=e.id,e.id=null)})},n.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)r.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");r.error("In a hurry? We're still trying to make the initial connection!")}},n.prototype.listAllPeers=function(e){e=e||function(){};var t=this,n=new XMLHttpRequest,i=this.options.secure?"https://":"http://",o=i+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers",s="?ts="+(new Date).getTime()+Math.random();o+=s,n.open("get",o,!0),n.onerror=function(){t._abort("server-error","Could not get peers from the server."),e([])},n.onreadystatechange=function(){if(4===n.readyState){if(401===n.status){var i="";throw i=t.options.host!==r.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",e([]),new Error("It doesn't look like you have permission to list peers IDs. "+i)}200!==n.status?e([]):e(JSON.parse(n.responseText))}},n.send(null)},t.exports=n},{"./dataconnection":15,"./mediaconnection":16,"./socket":19,"./util":20,eventemitter3:21}],19:[function(e,t){function n(e,t,r,o,s){if(!(this instanceof n))return new n(e,t,r,o,s);i.call(this),this.disconnected=!1,this._queue=[];var a=e?"https://":"http://",c=e?"wss://":"ws://";this._httpUrl=a+t+":"+r+o+s,this._wsUrl=c+t+":"+r+o+"peerjs?key="+s}var r=e("./util"),i=e("eventemitter3");r.inherits(n,i),n.prototype.start=function(e,t){this.id=e,this._httpUrl+="/"+e+"/"+t,this._wsUrl+="&id="+e+"&token="+t,this._startXhrStream(),this._startWebSocket()},n.prototype._startWebSocket=function(){var e=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(t){try{var n=JSON.parse(t.data)}catch(i){return r.log("Invalid server message",t.data),void 0}e.emit("message",n)},this._socket.onclose=function(){r.log("Socket closed."),e.disconnected=!0,e.emit("disconnected")},this._socket.onopen=function(){e._timeout&&(clearTimeout(e._timeout),setTimeout(function(){e._http.abort(),e._http=null},5e3)),e._sendQueuedMessages(),r.log("Socket open")})},n.prototype._startXhrStream=function(e){try{var t=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=e||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onerror=function(){clearTimeout(t._timeout),t.emit("disconnected")},this._http.onreadystatechange=function(){2==this.readyState&&this.old?(this.old.abort(),delete this.old):this.readyState>2&&200===this.status&&this.responseText&&t._handleStream(this)
},this._http.send(null),this._setHTTPTimeout()}catch(n){r.log("XMLHttpRequest not available; defaulting to WebSockets")}},n.prototype._handleStream=function(e){var t=e.responseText.split("\n");if(e._buffer)for(;e._buffer.length>0;){var n=e._buffer.shift(),i=t[n];try{i=JSON.parse(i)}catch(o){e._buffer.shift(n);break}this.emit("message",i)}var s=t[e._index];if(s)if(e._index+=1,e._index===t.length)e._buffer||(e._buffer=[]),e._buffer.push(e._index-1);else{try{s=JSON.parse(s)}catch(o){return r.log("Invalid server message",s),void 0}this.emit("message",s)}},n.prototype._setHTTPTimeout=function(){var e=this;this._timeout=setTimeout(function(){var t=e._http;e._wsOpen()?t.abort():(e._startXhrStream(t._streamIndex+1),e._http.old=t)},25e3)},n.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},n.prototype._sendQueuedMessages=function(){for(var e=0,t=this._queue.length;t>e;e+=1)this.send(this._queue[e])},n.prototype.send=function(e){if(!this.disconnected){if(!this.id)return this._queue.push(e),void 0;if(!e.type)return this.emit("error","Invalid message"),void 0;var t=JSON.stringify(e);if(this._wsOpen())this._socket.send(t);else{var n=new XMLHttpRequest,r=this._httpUrl+"/"+e.type.toLowerCase();n.open("post",r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(t)}}},n.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)},t.exports=n},{"./util":20,eventemitter3:21}],20:[function(e,t){var n={iceServers:[{url:"stun:stun.l.google.com:19302"}]},r=1,i=e("js-binarypack"),o=e("./adapter").RTCPeerConnection,s={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9e3,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(e){var t=parseInt(e,10);s.logLevel=isNaN(parseInt(e,10))?e?3:0:t,s.log=s.warn=s.error=s.noop,s.logLevel>0&&(s.error=s._printWith("ERROR")),s.logLevel>1&&(s.warn=s._printWith("WARNING")),s.logLevel>2&&(s.log=s._print)},setLogFunction:function(e){e.constructor!==Function?s.warn("The log function you passed in is not a function. Defaulting to regular logs."):s._print=e},_printWith:function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),s._print.apply(s,t)}},_print:function(){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,r=t.length;r>n;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)},defaultConfig:n,browser:function(){return window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported"}(),supports:function(){if("undefined"==typeof o)return{};var e,t,r=!0,i=!0,a=!1,c=!1,u=!!window.webkitRTCPeerConnection;try{e=new o(n,{optional:[{RtpDataChannels:!0}]})}catch(h){r=!1,i=!1}if(r)try{t=e.createDataChannel("_PEERJSTEST")}catch(h){r=!1}if(r){try{t.binaryType="blob",a=!0}catch(h){}var p=new o(n,{});try{var f=p.createDataChannel("_PEERJSRELIABLETEST",{});c=f.reliable}catch(h){}p.close()}if(i&&(i=!!e.addStream),!u&&r){var l=new o(n,{optional:[{RtpDataChannels:!0}]});l.onnegotiationneeded=function(){u=!0,s&&s.supports&&(s.supports.onnegotiationneeded=!0)},l.createDataChannel("_PEERJSNEGOTIATIONTEST"),setTimeout(function(){l.close()},1e3)}return e&&e.close(),{audioVideo:i,data:r,binaryBlob:a,binary:c,reliable:c,sctp:c,onnegotiationneeded:u}}(),validateId:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},validateKey:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},pack:i.pack,unpack:i.unpack,log:function(){if(s.debug){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,r=t.length;r>n;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)}},setZeroTimeout:function(e){function t(t){r.push(t),e.postMessage(i,"*")}function n(t){t.source==e&&t.data==i&&(t.stopPropagation&&t.stopPropagation(),r.length&&r.shift()())}var r=[],i="zero-timeout-message";return e.addEventListener?e.addEventListener("message",n,!0):e.attachEvent&&e.attachEvent("onmessage",n),t}(window),chunk:function(e){for(var t=[],n=e.size,i=index=0,o=Math.ceil(n/s.chunkedMTU);n>i;){var a=Math.min(n,i+s.chunkedMTU),c=e.slice(i,a),u={__peerData:r,n:index,data:c,total:o};t.push(u),i=a,index+=1}return r+=1,t},blobToArrayBuffer:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}};t.exports=s},{"./adapter":14,"js-binarypack":22}],21:[function(e,t){"use strict";function n(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(){}r.prototype._events=void 0,r.prototype.listeners=function(e){if(!this._events||!this._events[e])return[];if(this._events[e].fn)return[this._events[e].fn];for(var t=0,n=this._events[e].length,r=new Array(n);n>t;t++)r[t]=this._events[e][t].fn;return r},r.prototype.emit=function(e,t,n,r,i,o){if(!this._events||!this._events[e])return!1;var s,a,c=this._events[e],u=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,o),!0}for(a=1,s=new Array(u-1);u>a;a++)s[a-1]=arguments[a];c.fn.apply(c.context,s)}else{var h,p=c.length;for(a=0;p>a;a++)switch(c[a].once&&this.removeListener(e,c[a].fn,!0),u){case 1:c[a].fn.call(c[a].context);break;case 2:c[a].fn.call(c[a].context,t);break;case 3:c[a].fn.call(c[a].context,t,n);break;default:if(!s)for(h=1,s=new Array(u-1);u>h;h++)s[h-1]=arguments[h];c[a].fn.apply(c[a].context,s)}}return!0},r.prototype.on=function(e,t,r){var i=new n(t,r||this);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],i]:this._events[e].push(i):this._events[e]=i,this},r.prototype.once=function(e,t,r){var i=new n(t,r||this,!0);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],i]:this._events[e].push(i):this._events[e]=i,this},r.prototype.removeListener=function(e,t,n){if(!this._events||!this._events[e])return this;var r=this._events[e],i=[];if(t&&(r.fn&&(r.fn!==t||n&&!r.once)&&i.push(r),!r.fn))for(var o=0,s=r.length;s>o;o++)(r[o].fn!==t||n&&!r[o].once)&&i.push(r[o]);return i.length?this._events[e]=1===i.length?i[0]:i:delete this._events[e],this},r.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[e]:this._events={},this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.EventEmitter=r,r.EventEmitter2=r,r.EventEmitter3=r,t.exports=r},{}],22:[function(e,t){function n(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function r(){this.bufferBuilder=new s}function i(e){var t=e.charCodeAt(0);return 2047>=t?"00":65535>=t?"000":2097151>=t?"0000":67108863>=t?"00000":"000000"}function o(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,i).length}var s=e("./bufferbuilder").BufferBuilder,a=e("./bufferbuilder").binaryFeatures,c={unpack:function(e){var t=new n(e);return t.unpack()},pack:function(e){var t=new r;t.pack(e);var n=t.getBuffer();return n}};t.exports=c,n.prototype.unpack=function(){var e=this.unpack_uint8();if(128>e){var t=e;return t}if(32>(224^e)){var n=(224^e)-32;return n}var r;if((r=160^e)<=15)return this.unpack_raw(r);if((r=176^e)<=15)return this.unpack_string(r);if((r=144^e)<=15)return this.unpack_array(r);if((r=128^e)<=15)return this.unpack_map(r);switch(e){case 192:return null;case 193:return void 0;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return void 0;case 213:return void 0;case 214:return void 0;case 215:return void 0;case 216:return r=this.unpack_uint16(),this.unpack_string(r);case 217:return r=this.unpack_uint32(),this.unpack_string(r);case 218:return r=this.unpack_uint16(),this.unpack_raw(r);case 219:return r=this.unpack_uint32(),this.unpack_raw(r);case 220:return r=this.unpack_uint16(),this.unpack_array(r);case 221:return r=this.unpack_uint32(),this.unpack_array(r);case 222:return r=this.unpack_uint16(),this.unpack_map(r);case 223:return r=this.unpack_uint32(),this.unpack_map(r)}},n.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},n.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},n.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},n.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},n.prototype.unpack_int8=function(){var e=this.unpack_uint8();return 128>e?e:e-256},n.prototype.unpack_int16=function(){var e=this.unpack_uint16();return 32768>e?e:e-65536},n.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},n.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},n.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},n.prototype.unpack_string=function(e){for(var t,n,r=this.read(e),i=0,o="";e>i;)t=r[i],128>t?(o+=String.fromCharCode(t),i++):32>(192^t)?(n=(192^t)<<6|63&r[i+1],o+=String.fromCharCode(n),i+=2):(n=(15&t)<<12|(63&r[i+1])<<6|63&r[i+2],o+=String.fromCharCode(n),i+=3);return this.index+=e,o},n.prototype.unpack_array=function(e){for(var t=new Array(e),n=0;e>n;n++)t[n]=this.unpack();return t},n.prototype.unpack_map=function(e){for(var t={},n=0;e>n;n++){var r=this.unpack(),i=this.unpack();t[r]=i}return t},n.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=e>>31,n=(e>>23&255)-127,r=8388607&e|8388608;return(0==t?1:-1)*r*Math.pow(2,n-23)},n.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=e>>31,r=(e>>20&2047)-1023,i=1048575&e|1048576,o=i*Math.pow(2,r-20)+t*Math.pow(2,r-52);return(0==n?1:-1)*o},n.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},r.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},r.prototype.pack=function(e){var t=typeof e;if("string"==t)this.pack_string(e);else if("number"==t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==t)e===!0?this.bufferBuilder.append(195):e===!1&&this.bufferBuilder.append(194);else if("undefined"==t)this.bufferBuilder.append(192);else{if("object"!=t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var n=e.constructor;if(n==Array)this.pack_array(e);else if(n==Blob||n==File)this.pack_bin(e);else if(n==ArrayBuffer)a.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)a.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(n==Object)this.pack_object(e);else if(n==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+n.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},r.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(15>=t)this.pack_uint8(160+t);else if(65535>=t)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(4294967295>=t))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},r.prototype.pack_string=function(e){var t=o(e);if(15>=t)this.pack_uint8(176+t);else if(65535>=t)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(4294967295>=t))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},r.prototype.pack_array=function(e){var t=e.length;if(15>=t)this.pack_uint8(144+t);else if(65535>=t)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(4294967295>=t))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;t>n;n++)this.pack(e[n])},r.prototype.pack_integer=function(e){if(e>=-32&&127>=e)this.bufferBuilder.append(255&e);else if(e>=0&&255>=e)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&127>=e)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&65535>=e)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&32767>=e)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&4294967295>=e)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&2147483647>=e)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&0x8000000000000000>=e)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(e>=0&&0x10000000000000000>=e))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},r.prototype.pack_double=function(e){var t=0;0>e&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,n)-1,i=Math.floor(r*Math.pow(2,52)),o=Math.pow(2,32),s=t<<31|n+1023<<20|i/o&1048575,a=i%o;this.bufferBuilder.append(203),this.pack_int32(s),this.pack_int32(a)},r.prototype.pack_object=function(e){var t=Object.keys(e),n=t.length;if(15>=n)this.pack_uint8(128+n);else if(65535>=n)this.bufferBuilder.append(222),this.pack_uint16(n);else{if(!(4294967295>=n))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(n)}for(var r in e)e.hasOwnProperty(r)&&(this.pack(r),this.pack(e[r]))},r.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},r.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},r.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)},r.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},r.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)}},{"./bufferbuilder":23}],23:[function(e,t){function n(){this._pieces=[],this._parts=[]}var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),t.exports.binaryFeatures=r;var i=t.exports.BlobBuilder;"undefined"!=typeof window&&(i=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),n.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},n.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);r.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},n.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var e=new i,t=0,n=this._parts.length;n>t;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},t.exports.BufferBuilder=n},{}],24:[function(e,t){function n(e,t){return this instanceof n?(this._dc=e,r.debug=t,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC(),void 0):new n(e)}var r=e("./util");n.prototype.send=function(e){var t=r.pack(e);return t.size<this._mtu?(this._handleSend(["no",t]),void 0):(this._outgoing[this._count]={ack:0,chunks:this._chunk(t)},r.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1,void 0)},n.prototype._setupInterval=function(){var e=this;this._timeout=setInterval(function(){var t=e._queue.shift();if(t._multiple)for(var n=0,r=t.length;r>n;n+=1)e._intervalSend(t[n]);else e._intervalSend(t)},this._interval)},n.prototype._intervalSend=function(e){var t=this;e=r.pack(e),r.blobToBinaryString(e,function(e){t._dc.send(e)}),0===t._queue.length&&(clearTimeout(t._timeout),t._timeout=null)},n.prototype._processAcks=function(){for(var e in this._outgoing)this._outgoing.hasOwnProperty(e)&&this._sendWindowedChunks(e)},n.prototype._handleSend=function(e){for(var t=!0,n=0,r=this._queue.length;r>n;n+=1){var i=this._queue[n];i===e?t=!1:i._multiple&&-1!==i.indexOf(e)&&(t=!1)}t&&(this._queue.push(e),this._timeout||this._setupInterval())},n.prototype._setupDC=function(){var e=this;this._dc.onmessage=function(t){var n=t.data,i=n.constructor;if(i===String){var o=r.binaryStringToArrayBuffer(n);n=r.unpack(o),e._handleMessage(n)}}},n.prototype._handleMessage=function(e){var t,n=e[1],i=this._incoming[n],o=this._outgoing[n];switch(e[0]){case"no":var s=n;s&&this.onmessage(r.unpack(s));break;case"end":if(t=i,this._received[n]=e[2],!t)break;this._ack(n);break;case"ack":if(t=o){var a=e[2];t.ack=Math.max(a,t.ack),t.ack>=t.chunks.length?(r.log("Time: ",new Date-t.timer),delete this._outgoing[n]):this._processAcks()}break;case"chunk":if(t=i,!t){var c=this._received[n];if(c===!0)break;t={ack:["ack",n,0],chunks:[]},this._incoming[n]=t}var u=e[2],h=e[3];t.chunks[u]=new Uint8Array(h),u===t.ack[2]&&this._calculateNextAck(n),this._ack(n);break;default:this._handleSend(e)}},n.prototype._chunk=function(e){for(var t=[],n=e.size,i=0;n>i;){var o=Math.min(n,i+this._mtu),s=e.slice(i,o),a={payload:s};t.push(a),i=o}return r.log("Created",t.length,"chunks."),t},n.prototype._ack=function(e){var t=this._incoming[e].ack;this._received[e]===t[2]&&(this._complete(e),this._received[e]=!0),this._handleSend(t)},n.prototype._calculateNextAck=function(e){for(var t=this._incoming[e],n=t.chunks,r=0,i=n.length;i>r;r+=1)if(void 0===n[r])return t.ack[2]=r,void 0;t.ack[2]=n.length},n.prototype._sendWindowedChunks=function(e){r.log("sendWindowedChunks for: ",e);for(var t=this._outgoing[e],n=t.chunks,i=[],o=Math.min(t.ack+this._window,n.length),s=t.ack;o>s;s+=1)n[s].sent&&s!==t.ack||(n[s].sent=!0,i.push(["chunk",e,s,n[s].payload]));t.ack+this._window>=n.length&&i.push(["end",e,n.length]),i._multiple=!0,this._handleSend(i)},n.prototype._complete=function(e){r.log("Completed called for",e);var t=this,n=this._incoming[e].chunks,i=new Blob(n);r.blobToArrayBuffer(i,function(e){t.onmessage(r.unpack(e))}),delete this._incoming[e]},n.higherBandwidthSDP=function(e){var t=navigator.appVersion.match(/Chrome\/(.*?) /);if(t&&(t=parseInt(t[1].split(".").shift()),31>t)){var n=e.split("b=AS:30"),r="b=AS:102400";if(n.length>1)return n[0]+r+n[1]}return e},n.prototype.onmessage=function(){},t.exports.Reliable=n},{"./util":25}],25:[function(e,t){var n=e("js-binarypack"),r={debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},pack:n.pack,unpack:n.unpack,log:function(){if(r.debug){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.unshift("Reliable: "),console.log.apply(console,e)}},setZeroTimeout:function(e){function t(t){r.push(t),e.postMessage(i,"*")}function n(t){t.source==e&&t.data==i&&(t.stopPropagation&&t.stopPropagation(),r.length&&r.shift()())}var r=[],i="zero-timeout-message";return e.addEventListener?e.addEventListener("message",n,!0):e.attachEvent&&e.attachEvent("onmessage",n),t}(this),blobToArrayBuffer:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};t.exports=r},{"js-binarypack":22}],26:[function(e,t,n){function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);var i,o=typeof e;if("number"===o)i=e>0?e>>>0:0;else if("string"===o)"base64"===t&&(e=E(e)),i=r.byteLength(e,t);else{if("object"!==o||null===e)throw new TypeError("must start with number, buffer, array or string");"Buffer"===e.type&&D(e.data)&&(e=e.data),i=+e.length>0?Math.floor(+e.length):0}if(this.length>U)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+U.toString(16)+" bytes");var s;r.TYPED_ARRAY_SUPPORT?s=r._augment(new Uint8Array(i)):(s=this,s.length=i,s._isBuffer=!0);var a;if(r.TYPED_ARRAY_SUPPORT&&"number"==typeof e.byteLength)s._set(e);else if(S(e))if(r.isBuffer(e))for(a=0;i>a;a++)s[a]=e.readUInt8(a);else for(a=0;i>a;a++)s[a]=(e[a]%256+256)%256;else if("string"===o)s.write(e,0,t);else if("number"===o&&!r.TYPED_ARRAY_SUPPORT&&!n)for(a=0;i>a;a++)s[a]=0;return s}function i(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=t.length;if(o%2!==0)throw new Error("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;r>s;s++){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))throw new Error("Invalid hex string");e[n+s]=a}return s}function o(e,t,n,r){var i=P(T(t),e,n,r);return i}function s(e,t,n,r){var i=P(C(t),e,n,r);return i}function a(e,t,n,r){return s(e,t,n,r)}function c(e,t,n,r){var i=P(I(t),e,n,r);return i}function u(e,t,n,r){var i=P(L(t),e,n,r);return i}function h(e,t,n){return 0===t&&n===e.length?x.fromByteArray(e):x.fromByteArray(e.slice(t,n))}function p(e,t,n){var r="",i="";n=Math.min(e.length,n);for(var o=t;n>o;o++)e[o]<=127?(r+=R(i)+String.fromCharCode(e[o]),i=""):i+="%"+e[o].toString(16);return r+R(i)}function f(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;n>i;i++)r+=String.fromCharCode(e[i]);return r}function l(e,t,n){return f(e,t,n)}function d(e,t,n){var r=e.length;(!t||0>t)&&(t=0),(!n||0>n||n>r)&&(n=r);for(var i="",o=t;n>o;o++)i+=A(e[o]);return i}function v(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function y(e,t,n){if(e%1!==0||0>e)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function g(e,t,n,i,o,s){if(!r.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>o||s>t)throw new TypeError("value is out of bounds");if(n+i>e.length)throw new TypeError("index out of range")}function _(e,t,n,r){0>t&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);o>i;i++)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function m(e,t,n,r){0>t&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);o>i;i++)e[n+i]=t>>>8*(r?i:3-i)&255}function b(e,t,n,r,i,o){if(t>i||o>t)throw new TypeError("value is out of bounds");if(n+r>e.length)throw new TypeError("index out of range")}function w(e,t,n,r,i){return i||b(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),M.write(e,t,n,r,23,4),n+4}function k(e,t,n,r,i){return i||b(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),M.write(e,t,n,r,52,8),n+8}function E(e){for(e=B(e).replace(z,"");e.length%4!==0;)e+="=";return e}function B(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function S(e){return D(e)||r.isBuffer(e)||e&&"object"==typeof e&&"number"==typeof e.length}function A(e){return 16>e?"0"+e.toString(16):e.toString(16)}function T(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(127>=r)t.push(r);else{var i=n;r>=55296&&57343>=r&&n++;for(var o=encodeURIComponent(e.slice(i,n+1)).substr(1).split("%"),s=0;s<o.length;s++)t.push(parseInt(o[s],16))}}return t}function C(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}function L(e){for(var t,n,r,i=[],o=0;o<e.length;o++)t=e.charCodeAt(o),n=t>>8,r=t%256,i.push(r),i.push(n);return i}function I(e){return x.toByteArray(e)}function P(e,t,n,r){for(var i=0;r>i&&!(i+n>=t.length||i>=e.length);i++)t[i+n]=e[i];return i}function R(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}var x=e("base64-js"),M=e("ieee754"),D=e("is-array");n.Buffer=r,n.SlowBuffer=r,n.INSPECT_MAX_BYTES=50,r.poolSize=8192;var U=1073741823;r.TYPED_ARRAY_SUPPORT=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(n){return!1}}(),r.isBuffer=function(e){return!(null==e||!e._isBuffer)},r.compare=function(e,t){if(!r.isBuffer(e)||!r.isBuffer(t))throw new TypeError("Arguments must be Buffers");for(var n=e.length,i=t.length,o=0,s=Math.min(n,i);s>o&&e[o]===t[o];o++);return o!==s&&(n=e[o],i=t[o]),i>n?-1:n>i?1:0},r.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(e,t){if(!D(e))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===e.length)return new r(0);if(1===e.length)return e[0];var n;if(void 0===t)for(t=0,n=0;n<e.length;n++)t+=e[n].length;var i=new r(t),o=0;for(n=0;n<e.length;n++){var s=e[n];s.copy(i,o),o+=s.length}return i},r.byteLength=function(e,t){var n;switch(e+="",t||"utf8"){case"ascii":case"binary":case"raw":n=e.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*e.length;break;case"hex":n=e.length>>>1;break;case"utf8":case"utf-8":n=T(e).length;break;case"base64":n=I(e).length;break;default:n=e.length}return n},r.prototype.length=void 0,r.prototype.parent=void 0,r.prototype.toString=function(e,t,n){var r=!1;if(t>>>=0,n=void 0===n||1/0===n?this.length:n>>>0,e||(e="utf8"),0>t&&(t=0),n>this.length&&(n=this.length),t>=n)return"";for(;;)switch(e){case"hex":return d(this,t,n);case"utf8":case"utf-8":return p(this,t,n);case"ascii":return f(this,t,n);case"binary":return l(this,t,n);case"base64":return h(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}},r.prototype.equals=function(e){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");return 0===r.compare(this,e)},r.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},r.prototype.compare=function(e){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");return r.compare(this,e)},r.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},r.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},r.prototype.write=function(e,t,n,r){if(isFinite(t))isFinite(n)||(r=n,n=void 0);else{var h=r;r=t,t=n,n=h}t=Number(t)||0;var p=this.length-t;n?(n=Number(n),n>p&&(n=p)):n=p,r=String(r||"utf8").toLowerCase();var f;switch(r){case"hex":f=i(this,e,t,n);break;case"utf8":case"utf-8":f=o(this,e,t,n);break;case"ascii":f=s(this,e,t,n);break;case"binary":f=a(this,e,t,n);break;case"base64":f=c(this,e,t,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":f=u(this,e,t,n);break;default:throw new TypeError("Unknown encoding: "+r)}return f},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},r.prototype.slice=function(e,t){var n=this.length;if(e=~~e,t=void 0===t?n:~~t,0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),e>t&&(t=e),r.TYPED_ARRAY_SUPPORT)return r._augment(this.subarray(e,t));for(var i=t-e,o=new r(i,void 0,!0),s=0;i>s;s++)o[s]=this[s+e];return o},r.prototype.readUInt8=function(e,t){return t||y(e,1,this.length),this[e]},r.prototype.readUInt16LE=function(e,t){return t||y(e,2,this.length),this[e]|this[e+1]<<8},r.prototype.readUInt16BE=function(e,t){return t||y(e,2,this.length),this[e]<<8|this[e+1]},r.prototype.readUInt32LE=function(e,t){return t||y(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},r.prototype.readUInt32BE=function(e,t){return t||y(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},r.prototype.readInt8=function(e,t){return t||y(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},r.prototype.readInt16LE=function(e,t){t||y(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt16BE=function(e,t){t||y(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt32LE=function(e,t){return t||y(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},r.prototype.readInt32BE=function(e,t){return t||y(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},r.prototype.readFloatLE=function(e,t){return t||y(e,4,this.length),M.read(this,e,!0,23,4)},r.prototype.readFloatBE=function(e,t){return t||y(e,4,this.length),M.read(this,e,!1,23,4)},r.prototype.readDoubleLE=function(e,t){return t||y(e,8,this.length),M.read(this,e,!0,52,8)},r.prototype.readDoubleBE=function(e,t){return t||y(e,8,this.length),M.read(this,e,!1,52,8)},r.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,1,255,0),r.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e,t+1},r.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,2,65535,0),r.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8):_(this,e,t,!0),t+2},r.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,2,65535,0),r.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e):_(this,e,t,!1),t+2},r.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,4,4294967295,0),r.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e):m(this,e,t,!0),t+4},r.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,4,4294967295,0),r.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e):m(this,e,t,!1),t+4
},r.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,1,127,-128),r.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),0>e&&(e=255+e+1),this[t]=e,t+1},r.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,2,32767,-32768),r.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8):_(this,e,t,!0),t+2},r.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,2,32767,-32768),r.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e):_(this,e,t,!1),t+2},r.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,4,2147483647,-2147483648),r.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):m(this,e,t,!0),t+4},r.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||g(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),r.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e):m(this,e,t,!1),t+4},r.prototype.writeFloatLE=function(e,t,n){return w(this,e,t,!0,n)},r.prototype.writeFloatBE=function(e,t,n){return w(this,e,t,!1,n)},r.prototype.writeDoubleLE=function(e,t,n){return k(this,e,t,!0,n)},r.prototype.writeDoubleBE=function(e,t,n){return k(this,e,t,!1,n)},r.prototype.copy=function(e,t,n,i){var o=this;if(n||(n=0),i||0===i||(i=this.length),t||(t=0),i!==n&&0!==e.length&&0!==o.length){if(n>i)throw new TypeError("sourceEnd < sourceStart");if(0>t||t>=e.length)throw new TypeError("targetStart out of bounds");if(0>n||n>=o.length)throw new TypeError("sourceStart out of bounds");if(0>i||i>o.length)throw new TypeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var s=i-n;if(1e3>s||!r.TYPED_ARRAY_SUPPORT)for(var a=0;s>a;a++)e[a+t]=this[a+n];else e._set(this.subarray(n,n+s),t)}},r.prototype.fill=function(e,t,n){if(e||(e=0),t||(t=0),n||(n=this.length),t>n)throw new TypeError("end < start");if(n!==t&&0!==this.length){if(0>t||t>=this.length)throw new TypeError("start out of bounds");if(0>n||n>this.length)throw new TypeError("end out of bounds");var r;if("number"==typeof e)for(r=t;n>r;r++)this[r]=e;else{var i=T(e.toString()),o=i.length;for(r=t;n>r;r++)this[r]=i[r%o]}return this}},r.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(r.TYPED_ARRAY_SUPPORT)return new r(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;n>t;t+=1)e[t]=this[t];return e.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var O=r.prototype;r._augment=function(e){return e.constructor=r,e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=O.get,e.set=O.set,e.write=O.write,e.toString=O.toString,e.toLocaleString=O.toString,e.toJSON=O.toJSON,e.equals=O.equals,e.compare=O.compare,e.copy=O.copy,e.slice=O.slice,e.readUInt8=O.readUInt8,e.readUInt16LE=O.readUInt16LE,e.readUInt16BE=O.readUInt16BE,e.readUInt32LE=O.readUInt32LE,e.readUInt32BE=O.readUInt32BE,e.readInt8=O.readInt8,e.readInt16LE=O.readInt16LE,e.readInt16BE=O.readInt16BE,e.readInt32LE=O.readInt32LE,e.readInt32BE=O.readInt32BE,e.readFloatLE=O.readFloatLE,e.readFloatBE=O.readFloatBE,e.readDoubleLE=O.readDoubleLE,e.readDoubleBE=O.readDoubleBE,e.writeUInt8=O.writeUInt8,e.writeUInt16LE=O.writeUInt16LE,e.writeUInt16BE=O.writeUInt16BE,e.writeUInt32LE=O.writeUInt32LE,e.writeUInt32BE=O.writeUInt32BE,e.writeInt8=O.writeInt8,e.writeInt16LE=O.writeInt16LE,e.writeInt16BE=O.writeInt16BE,e.writeInt32LE=O.writeInt32LE,e.writeInt32BE=O.writeInt32BE,e.writeFloatLE=O.writeFloatLE,e.writeFloatBE=O.writeFloatBE,e.writeDoubleLE=O.writeDoubleLE,e.writeDoubleBE=O.writeDoubleBE,e.fill=O.fill,e.inspect=O.inspect,e.toArrayBuffer=O.toArrayBuffer,e};var z=/[^+\/0-9A-z]/g},{"base64-js":27,ieee754:28,"is-array":29}],27:[function(e,t,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===s?62:t===a?63:c>t?-1:c+10>t?t-c+26+26:h+26>t?t-h:u+26>t?t-u+26:void 0}function n(e){function n(e){u[p++]=e}var r,i,s,a,c,u;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=e.length;c="="===e.charAt(h-2)?2:"="===e.charAt(h-1)?1:0,u=new o(3*e.length/4-c),s=c>0?e.length-4:e.length;var p=0;for(r=0,i=0;s>r;r+=4,i+=3)a=t(e.charAt(r))<<18|t(e.charAt(r+1))<<12|t(e.charAt(r+2))<<6|t(e.charAt(r+3)),n((16711680&a)>>16),n((65280&a)>>8),n(255&a);return 2===c?(a=t(e.charAt(r))<<2|t(e.charAt(r+1))>>4,n(255&a)):1===c&&(a=t(e.charAt(r))<<10|t(e.charAt(r+1))<<4|t(e.charAt(r+2))>>2,n(a>>8&255),n(255&a)),u}function i(e){function t(e){return r.charAt(e)}function n(e){return t(e>>18&63)+t(e>>12&63)+t(e>>6&63)+t(63&e)}var i,o,s,a=e.length%3,c="";for(i=0,s=e.length-a;s>i;i+=3)o=(e[i]<<16)+(e[i+1]<<8)+e[i+2],c+=n(o);switch(a){case 1:o=e[e.length-1],c+=t(o>>2),c+=t(o<<4&63),c+="==";break;case 2:o=(e[e.length-2]<<8)+e[e.length-1],c+=t(o>>10),c+=t(o>>4&63),c+=t(o<<2&63),c+="="}return c}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="+".charCodeAt(0),a="/".charCodeAt(0),c="0".charCodeAt(0),u="a".charCodeAt(0),h="A".charCodeAt(0);e.toByteArray=n,e.fromByteArray=i}("undefined"==typeof n?this.base64js={}:n)},{}],28:[function(e,t,n){n.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,h=-7,p=n?i-1:0,f=n?-1:1,l=e[t+p];for(p+=f,o=l&(1<<-h)-1,l>>=-h,h+=a;h>0;o=256*o+e[t+p],p+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+e[t+p],p+=f,h-=8);if(0===o)o=1-u;else{if(o===c)return s?0/0:1/0*(l?-1:1);s+=Math.pow(2,r),o-=u}return(l?-1:1)*s*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,h=(1<<u)-1,p=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,l=r?0:o-1,d=r?1:-1,v=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(a=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),t+=s+p>=1?f/c:f*Math.pow(2,1-p),t*c>=2&&(s++,c/=2),s+p>=h?(a=0,s=h):s+p>=1?(a=(t*c-1)*Math.pow(2,i),s+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,i),s=0));i>=8;e[n+l]=255&a,l+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+l]=255&s,l+=d,s/=256,u-=8);e[n+l-d]|=128*v}},{}],29:[function(e,t){var n=Array.isArray,r=Object.prototype.toString;t.exports=n||function(e){return!!e&&"[object Array]"==r.call(e)}},{}],30:[function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,a=new Array(i-1),c=1;i>c;c++)a[c-1]=arguments[c];n.apply(this,a)}else if(o(n)){for(i=arguments.length,a=new Array(i-1),c=1;i>c;c++)a[c-1]=arguments[c];for(u=n.slice(),i=u.length,c=0;i>c;c++)u[c].apply(this,a)}return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned){var i;i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-->0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},{}]},{},[1]);